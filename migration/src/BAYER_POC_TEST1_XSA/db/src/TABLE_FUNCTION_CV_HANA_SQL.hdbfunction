FUNCTION "BAYER_POC_TEST1::TABLE_FUNCTION_CV_HANA_SQL" ()
RETURNS TABLE ("YEARMONTH" VARCHAR (6), "CUSTOMER_ID" VARCHAR (6), "PRODUCT_ID" VARCHAR (5), "PRODUCTGROUP_ID" VARCHAR (4), "CHANNEL_ID" VARCHAR (1), "BILLED_QUANTITY" INTEGER, "NET_SALES" INTEGER, "INDUSTRY_ID" VARCHAR (4), "CUSTOMER_SHIPPING" VARCHAR (6), "BILLED_QUANTITY_BUDGET" INTEGER, "NET_SALES_BUDGET" INTEGER, "INDUSTRY_TEXT" VARCHAR (50), "CUSTOMER_NATION" VARCHAR (50), "CUSTOMER_CITY" VARCHAR (50))
LANGUAGE SQLSCRIPT
SQL SECURITY DEFINER
  AS 

 
 /********* Begin Procedure Script ************/ 
 BEGIN 
 
 CALL  "BAYER_POC_TEST1.bayer_poc.BAYER_POC_TEST::HANA_TEST" (IT_CUSTOMER);
 
 IT_SALES = select A."YEARMONTH",
A."CUSTOMER_ID",
A."PRODUCT_ID",
A."PRODUCTGROUP_ID",
A."CHANNEL_ID",
A."BILLED_QUANTITY",
A."NET_SALES",
A."INDUSTRY_ID",
A."CUSTOMER_SHIPPING", B."BILLED_QUANTITY_BUDGET",
B."NET_SALES_BUDGET", C."INDUSTRY_TEXT",
D."CUSTOMER_NATION", D."CUSTOMER_CITY"
 from "BAYER_POC_TEST1.bayer_poc::HA_SALES" as A inner join "BAYER_POC_TEST1.bayer_poc::HA_SALES_BUDGET" as B on
 A."YEARMONTH" = B."YEARMONTH" and A."CUSTOMER_ID" = B."CUSTOMER_ID" and 
A."PRODUCT_ID" = B."PRODUCT_ID" and 
A."PRODUCTGROUP_ID" = B."PRODUCTGROUP_ID" and 
A."CHANNEL_ID" = B."CHANNEL_ID" left outer join "BAYER_POC_TEST1.hana_academy::HA_INDUSTRY_TEXT" as C 
on A."INDUSTRY_ID" = C."INDUSTRY_ID" left outer join :IT_CUSTOMER as D on 
A."CUSTOMER_ID" = D."CUSTOMER_ID";
 
var_out = SELECT "YEARMONTH",
"CUSTOMER_ID",
"PRODUCT_ID",
"PRODUCTGROUP_ID",
"CHANNEL_ID",
"BILLED_QUANTITY",
"NET_SALES",
"INDUSTRY_ID",
"CUSTOMER_SHIPPING", "BILLED_QUANTITY_BUDGET",
"NET_SALES_BUDGET", "INDUSTRY_TEXT",
"CUSTOMER_NATION",
"CUSTOMER_CITY" from :IT_SALES;


return :var_out;
END;